name: Editor Tests

on:
  workflow_call:
    inputs:
      projectPath:
        required: true
        type: string
      unityVersion:
        required: true
        type: string
      testMode:
        required: true
        type: string
      unityEmail:
        required: true
        type: string
      unityPassword:
        required: true
        type: string
      unityLicense:
        required: true
        type: string
      githubToken:
        required: true
        type: string

jobs:
  test:
    name: ${{ inputs.unityVersion }} ${{ inputs.testMode }}
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          lfs: false
      - uses: actions/cache@v4
        with:
          path: ${{ inputs.projectPath }}/Library
          key: Library-${{ inputs.unityVersion }}
          restore-keys: |
            Library-
      - uses: game-ci/unity-test-runner@v4
        id: tests
        env:
          UNITY_LICENSE: ${{ inputs.unityLicense }}
          UNITY_EMAIL: ${{ inputs.unityEmail }}
          UNITY_PASSWORD: ${{ inputs.unityPassword }}
        with:
          projectPath: ${{ inputs.projectPath }}
          unityVersion: ${{ inputs.unityVersion }}
          testMode: ${{ inputs.testMode }}
          artifactsPath: ${{ inputs.testMode }}-artifacts
          githubToken: ${{ inputs.githubToken }}
          checkName: ${{ inputs.unityVersion }} ${{ inputs.testMode }} Test Results